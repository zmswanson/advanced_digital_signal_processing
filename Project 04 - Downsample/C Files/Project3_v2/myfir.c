/*
// *****************************************************************************
// *****************************************************************************
// **
// ** File Name: myfir.c
// **
// ** Author: David McCreight
// **
// ** Description: 
// **              
// **
// *****************************************************************************
// *****************************************************************************
*/

/*******************************************************************************
****                            I N C L U D E S 
*******************************************************************************/

#include "stdint.h"
#include "stdio.h"

/*******************************************************************************
****                         D E F I N I T I O N S
*******************************************************************************/

/*******************************************************************************
****                   S T A T I C   V A R I A B L E S  
*******************************************************************************/

/*******************************************************************************
****                    G L O B A L   V A R I A B L E S  
*******************************************************************************/

/*******************************************************************************
****          F U N C T I O N   D E F I N I T I O N S 
*******************************************************************************/
void myfir(const int16_t* input,
             const int16_t* filterCoeffs,
			 int16_t* output,
			 int16_t* delayLine,
			 uint16_t  nx,
			 uint16_t  nh)
{
    
    uint16_t i;
    uint16_t j;
    long sum = 0;
	
    /*
     * Assumes delayLine length is nh - 1 + nx
     */

    // copy input samples to the delay line
    for (i = 0; i < nx; i++)
    {
        delayLine[i + nh - 1] = input[i];
    }

	for (i = 0; i < nx; i++)
	{
		for (j = 0; j < nh; j++)
		{
			sum = _smacr(sum, filterCoeffs[j], delayLine[i + nh - 1 - j]);
		}

		output[i] = (int16_t)(sum >> 15);
		sum = 0;
	}
		
    // Update delay line for next function call
	for (i = 0; i < (nh - 1); i++)
	{
		delayLine[i] = delayLine[nx + i];
	}
}

/*******************************************************************************
 ****                        E N D   O F   F I L E
 *******************************************************************************/

