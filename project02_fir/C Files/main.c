/*
 * main.c
 */

#include "stdint.h"
#include "stdio.h"
#include "string.h"
#include "testVector.h"
#include "ezdsp5535.h"
#include "ezdsp5535_gpio.h"
#include "ezdsp5535_i2c.h"

#define myNH 		  54	// # of filter coefficients
#define myNX 		   1	// # of samples evaluated per function call
#define inLen		 240	// # of total input samples

/* Coefficient array (length = 54) of a 53rd order FIR filter */
const int16_t h53[] =
{
        24,     17,     17,     11,     -5,    -32,    -72,   -123,   -184,   -249,   -309,   -354,   -374,   -354,   -286,   -159,
        32,    287,    601,    962,   1354,   1755,   2141,   2489,   2773,   2975,   3080,   3080,   2975,   2773,   2489,   2141,
      1755,   1354,    962,    601,    287,     32,   -159,   -286,   -354,   -374,   -354,   -309,   -249,   -184,   -123,    -72,
       -32,     -5,     11,     17,     17,     24
};

int16_t out1[inLen];

int16_t delayLine1[myNH + myNX - 1];
int16_t delayLine2[myNH + myNX - 1];

extern Int16 aic3204_loop_linein( );

extern void myfir(const int16_t* input, const int16_t* filterCoeffs, int16_t* output,
		int16_t* delayLine, uint16_t  nx, uint16_t  nh);

/*
 * main -
 */

int main(void)
{
    /* Initialize BSL */
    EZDSP5535_init( );

    /* Initialize I2C */
    EZDSP5535_I2C_init( );

	static uint16_t i;

	/* Inialize output and delay line arrays to zeros */
	memset( out1, 0, sizeof( out1 ) );
	memset( delayLine1, 0, sizeof( delayLine1 ) );
	memset( delayLine1, 0, sizeof( delayLine1 ) );

	while(1)
	{

//		for(i = 0; i < inLen; i += myNX)
//		{
//			myfir(&inputTestVector[i], h53, &out1[i], delayLine1, myNX, myNH);
//		}

		aic3204_loop_linein( );

		/* Clear out1 and delayLine1 */
		memset( out1, 0, sizeof( out1 ) );
		memset( delayLine2, 0, sizeof( delayLine2 ) );
		memset( delayLine2, 0, sizeof( delayLine2 ) );
	}
	
	return 0;
}

//static const int16_t h60[] =
//{
//		25,     26,     35,     42,     46,     42,     29,      4,    -34,    -85,   -146,   -214,   -282,   -342,   -384,   -398,
//	  -374,   -303,   -177,      5,    245,    536,    869,   1230,   1602,   1964,   2297,   2581,   2797,   2933,   2979,   2933,
//	  2797,   2581,   2297,   1964,   1602,   1230,    869,    536,    245,      5,   -177,   -303,   -374,   -398,   -384,   -342,
//	  -282,   -214,   -146,    -85,    -34,      4,     29,     42,     46,     42,     35,     26,     25
//};
//
//static const int16_t h70[] =
//{
//		21,     24,     36,     50,     63,     75,     83,     86,     80,     64,     36,     -4,    -56,   -118,   -186,   -256,
//	  -322,   -377,   -412,   -419,   -392,   -324,   -211,    -51,    156,    405,    690,   1001,   1324,   1647,   1954,   2230,
//	  2462,   2637,   2746,   2783,   2746,   2637,   2462,   2230,   1954,   1647,   1324,   1001,    690,    405,    156,    -51,
//	  -211,   -324,   -392,   -419,   -412,   -377,   -322,   -256,   -186,   -118,    -56,     -4,     36,     64,     80,     86,
//		83,     75,     63,     50,     36,     24,     21
//};
//
//static const int16_t h80[] =
//{
//		-4,     14,     19,     29,     42,     58,     74,     90,    104,    115,    119,    116,    104,     81,     46,      0,
//	   -56,   -120,   -189,   -257,   -320,   -372,   -405,   -413,   -392,   -335,   -239,   -103,     74,    288,    534,    805,
//	  1093,   1386,   1673,   1942,   2181,   2379,   2527,   2619,   2651,   2619,   2527,   2379,   2181,   1942,   1673,   1386,
//	  1093,    805,    534,    288,     74,   -103,   -239,   -335,   -392,   -413,   -405,   -372,   -320,   -257,   -189,   -120,
//	   -56,      0,     46,     81,    104,    116,    119,    115,    104,     90,     74,     58,     42,     29,     19,     14,
//		-4
//};
//
//static const int16_t h90[] =
//{
//	   -16,     -6,     -4,     -1,      4,     12,     23,     37,     53,     70,     88,    105,    119,    129,    133,    129,
//	   115,     90,     54,      8,    -48,   -111,   -178,   -246,   -309,   -361,   -399,   -414,   -404,   -362,   -287,   -175,
//	   -26,    157,    371,    612,    872,   1142,   1414,   1677,   1921,   2136,   2314,   2447,   2528,   2556,   2528,   2447,
//	  2314,   2136,   1921,   1677,   1414,   1142,    872,    612,    371,    157,    -26,   -175,   -287,   -362,   -404,   -414,
//	  -399,   -361,   -309,   -246,   -178,   -111,    -48,      8,     54,     90,    115,    129,    133,    129,    119,    105,
//		88,     70,     53,     37,     23,     12,      4,     -1,     -4,     -6,    -16
//};
//
//static const int16_t h100[] =
//{
//	   -19,    -13,    -17,    -20,    -21,    -21,    -19,    -14,     -6,      6,     21,     38,     58,     79,    101,    121,
//	   137,    149,    153,    149,    135,    110,     74,     28,    -28,    -92,   -159,   -228,   -293,   -349,   -392,   -417,
//	  -418,   -391,   -334,   -244,   -121,     36,    223,    437,    672,    922,   1179,   1434,   1679,   1904,   2102,   2264,
//	  2385,   2459,   2484,   2459,   2385,   2264,   2102,   1904,   1679,   1434,   1179,    922,    672,    437,    223,     36,
//	  -121,   -244,   -334,   -391,   -418,   -417,   -392,   -349,   -293,   -228,   -159,    -92,    -28,     28,     74,    110,
//	   135,    149,    153,    149,    137,    121,    101,     79,     58,     38,     21,      6,     -6,    -14,    -19,    -21,
//	   -21,    -20,    -17,    -13,    -19
//};
//
//static const int16_t h221[] =
//{
//        13,      7,      9,     10,     11,     13,     13,     14,     13,     13,     11,      9,      6,      2,     -2,     -7,
//       -12,    -18,    -24,    -29,    -35,    -40,    -43,    -46,    -48,    -48,    -47,    -43,    -38,    -32,    -24,    -14,
//        -4,      8,     19,     31,     41,     51,     59,     65,     69,     70,     67,     62,     54,     42,     28,     11,
//        -7,    -26,    -46,    -66,    -84,   -100,   -113,   -122,   -127,   -127,   -121,   -110,    -94,    -73,    -47,    -17,
//        15,     50,     84,    118,    149,    176,    197,    212,    219,    217,    205,    184,    154,    114,     66,     12,
//       -48,   -110,   -174,   -236,   -293,   -344,   -384,   -412,   -425,   -421,   -399,   -356,   -293,   -209,   -106,     17,
//       158,    313,    481,    658,    840,   1023,   1204,   1377,   1540,   1688,   1817,   1924,   2007,   2064,   2093,   2093,
//      2064,   2007,   1924,   1817,   1688,   1540,   1377,   1204,   1023,    840,    658,    481,    313,    158,     17,   -106,
//      -209,   -293,   -356,   -399,   -421,   -425,   -412,   -384,   -344,   -293,   -236,   -174,   -110,    -48,     12,     66,
//       114,    154,    184,    205,    217,    219,    212,    197,    176,    149,    118,     84,     50,     15,    -17,    -47,
//       -73,    -94,   -110,   -121,   -127,   -127,   -122,   -113,   -100,    -84,    -66,    -46,    -26,     -7,     11,     28,
//        42,     54,     62,     67,     70,     69,     65,     59,     51,     41,     31,     19,      8,     -4,    -14,    -24,
//       -32,    -38,    -43,    -47,    -48,    -48,    -46,    -43,    -40,    -35,    -29,    -24,    -18,    -12,     -7,     -2,
//         2,      6,      9,     11,     13,     13,     14,     13,     13,     11,     10,      9,      7,     13
//};
